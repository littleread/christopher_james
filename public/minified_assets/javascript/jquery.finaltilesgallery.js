function ftg_getURLParameter(d){return decodeURIComponent(((new RegExp("[?|&]"+d+"=([^&;]+?)(&|#|;|$)")).exec(location.search)||[,""])[1].replace(/\+/g,"%20"))||null}var qualifyURL=function(d){var g=document.createElement("img");g.src=d;d=g.src;g.src=null;return d};
(function(d,g,m,q){function n(a,b){this.element=a;this.$element=d(a);this.settings=d.extend({},p,b);this._columnSize=0;this._defaults=p;this._name="finalTilesGallery";this.tiles=[];this._loadedImages=0;this._rows=[[]];this._currentRowTile=this._currentRow=0;this.edges=[];this.imagesData={};this.currentWidth=0;this.currentImageSizeFactor=1;this.currentGridSize=this.currentColumnsCount=0;this.isLoading=this.ajaxComplete=!1;this.currentPage=1;this.init()}d.fn.visible=function(a){if(!d(this).offset())return!0;
var b=d(this),c=d(g),k=c.scrollTop();c=k+c.height();var f=b.offset().top;b=f+b.height();return(!0===a?f:b)<=c&&(!0===a?b:f)>=k};var p={layout:"final",columns:[[4E3,5],[1024,4],[800,3],[480,2],[320,1]],rowHeight:200,margin:10,minTileWidth:200,ignoreImageAttributes:!0,imageSizeFactor:[[4E3,.9],[1024,.8],[800,.7],[600,.6],[480,.5],[320,.3]],gridSize:10,disableGridSizeBelow:800,allowEnlargement:!0,autoLoadURL:null,selectedFilter:"",onComplete:function(){},onUpdate:function(){},onLoading:function(){},
debug:!1};d.extend(n.prototype,{print:function(a){this.settings.debug&&console.log(a)},setCurrentImageSizeFactor:function(){this.currentImageSizeFactor=1;for(var a=d(g).width(),b=0;b<this.settings.imageSizeFactor.length;b++)this.settings.imageSizeFactor[b][0]>=a&&(this.currentImageSizeFactor=this.settings.imageSizeFactor[b][1]);this.currentImageSizeFactor||(this.currentImageSizeFactor=1);this.print("current image size factor: "+this.currentImageSizeFactor+" ("+a+")")},setCurrentColumnSize:function(){for(var a=
d(g).width(),b=0;b<this.settings.columns.length;b++)this.settings.columns[b][0]>=a&&(this.currentColumnsCount=this.settings.columns[b][1]);this._columnSize=Math.floor((this.currentWidth-this.settings.margin*(this.currentColumnsCount-1))/this.currentColumnsCount);this.print(this.currentWidth,this._columnSize)},setCurrentGridSize:function(){this.currentGridSize=this.currentWidth<this.settings.disableGridSizeBelow?0:this.settings.gridSize*this.currentImageSizeFactor;this.print(this.currentGridSize);
console.log(this.currentGridSize)},init:function(){var a=this,b=this.settings.selectedFilter,c=ftg_getURLParameter("ftg-set");c&&(b=c);a.currentWidth=a.$element.width();if(0==a.$element.filter(":visible").length)a.print("cannot initialize the gallery, container is hidden. Retrying in 500ms."),setTimeout(function(){a.init()},500);else{this.$element.find(".ftg-items").css({position:"relative"});b=this.settings.selectedFilter;(c=ftg_getURLParameter("ftg-set"))&&(b=c);a=this;null!=b&&(a.print(".. found filter ("+
b+")"),a.$element.find(".ftg-filters a").removeClass("selected"),a.$element.find(".ftg-filters a").each(function(){d(this).data("filter")==b&&(a.print(".. selecting filter"),d(this).addClass("selected"))}));c=g.location.hash;this.$element.find(".ftg-items").css({position:"relative",minWidth:a.settings.minTileWidth});if(c&&"#ftg-set-ftgall"!=c&&"#ftg-set"==c.substr(0,8)||a.settings.selectedFilter){var k="#ftg-set-"+a.settings.selectedFilter;c&&(k=c);var f=k.replace("#","."),h=[];a.$element.find(".ftg-filters a").each(function(){h.push(d(this).attr("href"))});
0<=d.inArray(k,h)&&(f=f.substring(1),a.$element.find(".ftg-filters a").each(function(){d(this).attr("href")!=k&&(a.$element.find(".item").each(function(){var a=d(this).parent().parent();0==a.hasClass(f)&&a.addClass("ftg-hidden-tile")}),d(this).removeClass("selected"))}),d('a[href="'+k+'"]').addClass("selected"))}this.tiles=this.$element.find(".tile").not(".ftg-hidden-tile");this.currentWidth=this.$element.width();this.print("this.currentWidth: "+this.currentWidth);"columns"!=this.settings.layout&&
"rows"!=this.settings.layout&&"final"!=this.settings.layout&&console.log("WARNING: unknown layout, falling back to 'final'.");"columns"==this.settings.layout&&this.setCurrentColumnSize();var e=0;this.setCurrentImageSizeFactor();this.setCurrentGridSize();d(g).resize(function(){e=setTimeout(function(){a.currentWidth!=a.$element.width()&&(clearTimeout(e),a.print("this.currentWidth",this.currentWidth),a.currentWidth=a.$element.width(),a.setCurrentColumnSize(),a.setCurrentImageSizeFactor(),a.setCurrentGridSize(),
a.refresh())},500)});a.isLoading=!0;a.settings.autoLoadURL&&d(g).scroll(function(){if(!a.ajaxComplete&&!a.isLoading&&a.tiles.last().visible()){a.isLoading=!0;if(a.settings.onLoading)a.settings.onLoading();d.get(a.settings.autoLoadURL,{page:++a.currentPage},function(b){if(a.settings.onUpdate)a.settings.onUpdate();0==d.trim(b).length?a.ajaxComplete=!0:(a.$element.find(".ftg-items").append(b),a.tiles=a.$element.find(".tile"),a.loadImage())})}});this.setupFilters();this.edges.push({left:0,top:0,width:this.currentWidth,
index:0});this.loadImage()}},addElements:function(a){this.$element.find(".ftg-items").append(a);this.tiles=this.$element.find(".tile");this.loadImage()},removeAt:function(a){this.tiles[a].remove();this.refresh()},clear:function(){this.$element.find(".ftg-items").height(0).empty();this.refresh()},setupFilters:function(){var a=this;a.$element.find(".ftg-filters a").click(function(b){b.preventDefault();a.$element.find(".ftg-filters a").removeClass("selected");d(this).addClass("selected");b=d(this).attr("href").replace("#ftg-set-",
"");"ftgall"==b?a.$element.find(".tile").removeClass("ftg-hidden-tile"):a.$element.find(".tile").not(".ftg-set-"+b).addClass("ftg-hidden-tile").end().filter(".ftg-set-"+b).removeClass("ftg-hidden-tile");a.refresh()})},printEdges:function(){this.$element.find(".edge").remove();for(i=0;i<this.edges.length;i++){var a=d("<div class='edge' />");a.append("top: "+this.edges[i].top+"<br>");a.append("left: "+this.edges[i].left+"<br>");a.append("width: "+this.edges[i].width+"<br>");a.css({left:this.edges[i].left,
top:this.edges[i].top,marginTop:-25,marginLeft:20});this.$element.append(a)}},printEdge:function(a){var b=d("<div class='edge enlarged-"+a.enlarged+"' />");b.append("<b>"+a.index+" "+a["case"]+"</b><br>");b.append("t: "+Math.round(a.top)+" l: "+a.left+"<br>");b.append("width: "+a.width+"<br>");b.append("idx: "+a.tileIndex+"<br>");b.css({left:a.left,top:a.top,marginTop:-25,marginLeft:20});this.$element.append(b)},refresh:function(){this.$element.find(".edge").remove();this.edges=[{left:0,top:0,width:this.currentWidth}];
this.tiles.removeClass("ftg-loaded ftg-enlarged");this.tiles=this.$element.find(".tile").not(".ftg-hidden-tile");this._loadedImages=0;this.loadImage()},getAvailableRowSpace:function(){return this.currentWidth-this.getBusyRowSpace()},getBusyRowSpace:function(){for(var a=0,b=0;b<this._rows[this._currentRow].length;b++)a+=this._rows[this._currentRow][b].data("width")+this.settings.margin;return a},addImageToRow:function(a){console.log(this._rows);console.log(this._currentRow);this._rows[this._currentRow].push(a)},
fitImagesInRow:function(){this.getAvailableRowSpace();for(var a=(this.currentWidth-(this._rows[this._currentRow].length-1)*this.settings.margin)/this.getBusyRowSpace(),b=0;b<this._rows[this._currentRow].length;b++){$item=this._rows[this._currentRow][b];var c=$item.data("width");$item.data("height");$item.data("width",c*a);this.add(this._currentRowTile++)}},nextTile:function(a){a&&this.add(this._loadedImages);++this._loadedImages<this.tiles.length?this.loadImage():(a=this.lowerEdgeTop(),this.print("lower edge top: "+
a),this.$element.find(".ftg-items").height(a),this.isLoading=!1,this.settings.onComplete())},loadImage:function(){var a=this,b=this.tiles.eq(this._loadedImages);b.children("iframe").length&&b.children("iframe").addClass("item");var c=b.find(".item");switch(c.get(0).tagName.toLowerCase()){case "img":var d=new Image;d.onload=function(){var f=a.currentImageSizeFactor;b.data("ftg-ignore-size-factor")&&(f=1);var h=!0;if("final"==a.settings.layout){var e=c.attr("width")?parseInt(c.attr("width")):d.width;
var k=c.attr("height")?parseInt(c.attr("height")):d.height;e*=f;k*=f}"columns"==a.settings.layout&&(e=a._columnSize,k=e*d.height/d.width);"rows"==a.settings.layout&&(e=a.settings.rowHeight*d.width/d.height,k=a.settings.rowHeight,h=!1,a.getAvailableRowSpace()>e||(a.fitImagesInRow(),a._currentRow++,a._rows.push([])),a.addImageToRow(c));c.attr("src",this.src);a.imagesData["tile"+a._loadedImages]={width:e,height:k,owidth:d.width,oheight:d.height,src:d.src};a.nextTile(h)};d.onerror=function(){a.print("error loading image: "+
d.src);a.nextTile(!0)};d.src=c.data("src");b.data("ftg-type","image");break;case "iframe":a.imagesData["tile"+a._loadedImages]={width:parseInt(c.attr("width")),height:parseInt(c.attr("height")),owidth:parseInt(c.attr("width")),oheight:parseInt(c.attr("height"))};b.data("ftg-type","iframe");a.nextTile(!0);break;default:a.imagesData["tile"+a._loadedImages]={width:parseInt(c.data("width")),height:parseInt(c.data("height")),owidth:parseInt(c.data("width")),oheight:parseInt(c.data("height"))},a.nextTile(!0)}},
higherEdge:function(){for(var a=1E5,b=0,c=0;c<this.edges.length;c++)this.edges[c].top<a&&(b=c,a=this.edges[c].top);return this.edges[b]},lowerEdgeTop:function(){for(var a=0,b=0;b<this.edges.length;b++)this.edges[b].top>a&&(a=this.edges[b].top);return a},alignEdge:function(a,b){for(var c=0;c<this.edges.length;c++)if(this.edges[c].left+this.edges[c].width+this.settings.margin==a.left&&(this.print("found edge on left",c),a.top==this.edges[c].top))return this.print("edges can be aligned [1]"),{side:"left",
edge:this.edges[c]};for(c=0;c<this.edges.length;c++)if(this.edges[c].left-this.settings.margin==a.left+a.width&&(this.print("found edge on right",c),a.top==this.edges[c].top))return this.print("edges can be aligned [2]"),{side:"right",edge:this.edges[c]};return null},removeEdge:function(a){for(var b=[],c=0;c<this.edges.length;c++)this.edges[c]!=a&&b.push(this.edges[c]);this.edges=b},add:function(a){var b=this.tiles.eq(a),c=b.find(".item"),d="tile"+a,f=this.imagesData[d].width,h=this.imagesData[d].height,
e=this.higherEdge();this.print(e);e.tileIndex=a;this.print(a+" ["+b.data("ftg-type")+"] ("+f+"x"+h+")");0<e.top&&(e.top+=this.settings.margin);b.css({left:e.left,top:e.top,position:"absolute"});e.enlarged=!1;if(e.width<f+this.settings.margin){e["case"]="Te";this.print("Te",e.width);var g=e.width,l=h/f*g;g+e.left-this.settings.margin==this.currentWidth&&(this.print("END"),g-=this.settings.margin,l=h/f*g);f=g;h=l}else e.width>f&&(this.print("tE"),"columns"==this.settings.layout||e.width-f>=this.settings.minTileWidth?
(e["case"]="tE",this.print("tE1",e.width,e.left,this.currentWidth),this.edges.push({left:e.left+f+this.settings.margin,top:e.top-(0<e.top?this.settings.margin:0),width:e.width-f-this.settings.margin,marginLeft:!0,"case":"NEW",index:e.index+1})):(e["case"]="tE2",this.print("tE2"),this.print("enlargement",e.width,e.left,this.currentWidth),g=e.width,l=this.settings.allowEnlargement&&"rows"!=this.settings.layout?h/f*g:h,this.settings.allowEnlargement?(b.addClass("ftg-enlarged"),e.enlarged=!0):"rows"!=
this.settings.layout&&b.find(".item").css({width:f,height:h}),f=g,h=l));e.top+=h;this.currentGridSize&&(g=e.top%this.currentGridSize,e.top-=g,h-=g);e.left=e.left;e.width=f;g=!0;if(a=this.alignEdge(e,a))"left"==a.side?(this.removeEdge(e),a.edge.width+=f+this.settings.margin,h-=e.top-a.edge.top,e.top-=h):(this.removeEdge(a.edge),e.width+=this.settings.margin+a.edge.width),g=!1,b.height(h);this.$element.find(".ftg-items").height()<e.top&&this.$element.find(".ftg-items").height(e.top);this.settings.debug&&
g&&this.printEdge(e);"iframe"==b.data("ftg-type")&&b.find("iframe").height(h);this.print(f+"x"+h);this.print("----");b.css({width:f,height:h});b.css("transition");b.css({display:"block",transform:"scale(1)"});d=f/this.imagesData[d].width*this.imagesData[d].height-h;"iframe"!=b.data("ftg-type")&&c.css({height:"auto"});0<d&&c.css({top:0-d/2});b.addClass("ftg-loaded")}});d.fn.finalTilesGallery=function(a){this.each(function(){d.data(this,"finalTilesGallery")||d.data(this,"finalTilesGallery",new n(this,
a))});return this};d(function(){d(".ftg-social a").click(function(a){a.preventDefault();a=d(this).data("social");var b=d(this).parents(".tile").first(),c=b.data("big");c||(c=b.find(".item").attr("src"));var k=d.trim(b.find(".subtitle").text());k.length||(k=m.title);b=d.trim(b.find(".title").text());b.length||(b=m.title);if("facebook"==a){var f="https://www.facebook.com/dialog/feed?app_id=1447224948871585&link="+encodeURIComponent(location.href)+"&display=popup&name="+encodeURIComponent(b)+"&caption=&description="+
encodeURIComponent(k)+"&picture="+encodeURIComponent(qualifyURL(c))+"&ref=share&actions={%22name%22:%22View%20the%20gallery%22,%20%22link%22:%22"+encodeURIComponent(location.href)+"%22}&redirect_uri=http://www.final-tiles-gallery.com/facebook_redirect.html";f=g.open(f,"ftgw","location=1,status=1,scrollbars=1,width=600,height=400");f.moveTo(screen.width/2-300,screen.height/2-200)}"twitter"==a&&(f=g.open("https://twitter.com/intent/tweet?url="+encodeURI(location.href.split("#")[0])+"&text="+encodeURI(b+
" "+k),"ftgw","location=1,status=1,scrollbars=1,width=600,height=400"),f.moveTo(screen.width/2-300,screen.height/2-200));"pinterest"==a&&(f="http://pinterest.com/pin/create/button/?url="+encodeURIComponent(location.href)+"&description="+encodeURI(b+" "+k),f+="&media="+encodeURIComponent(qualifyURL(c)),f=g.open(f,"ftgw","location=1,status=1,scrollbars=1,width=600,height=400"),f.moveTo(screen.width/2-300,screen.height/2-200));"google-plus"==a&&(f="https://plus.google.com/share?url="+encodeURI(location.href),
f=g.open(f,"ftgw","location=1,status=1,scrollbars=1,width=600,height=400"),f.moveTo(screen.width/2-300,screen.height/2-200))})})})(jQuery,window,document);